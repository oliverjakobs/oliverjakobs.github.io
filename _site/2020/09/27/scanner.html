<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/style.css" />
    
    <!-- Font Aweseome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.2/css/all.min.css"  />

    <title>{ devlog::scanner }</title>

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" />
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Scanner</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Scanner" />
<meta name="author" content="oliver" />
<meta property="og:locale" content="C" />
<meta name="description" content="Introduction and Scanner…" />
<meta property="og:description" content="Introduction and Scanner…" />
<link rel="canonical" href="http://localhost:4000/2020/09/27/scanner.html" />
<meta property="og:url" content="http://localhost:4000/2020/09/27/scanner.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-27T00:00:00+02:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/2020/09/27/scanner.html","headline":"Scanner","datePublished":"2020-09-27T00:00:00+02:00","dateModified":"2020-09-27T00:00:00+02:00","author":{"@type":"Person","name":"oliver"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/09/27/scanner.html"},"description":"Introduction and Scanner…","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <nav class="navbar">
  <label class="logo"><a href="/">devlog</a></label>
  <input type="checkbox" id="menu-check">
  <label for="menu-check" class="menu-btn"><i class="fas fa-bars"></i></label>
  <ul class="menu">
    
      <li><a href="/" >blog</a></li>
    
  </ul>
</nav>
    <div class="page-content container clearfix">
      <a href="/">&laquo; Back</a>

<h1 class="post-title">Scanner</h1>
<ul class="post-meta">
  <li><i class="far fa-calendar"></i>27 Sep 2020</li>
  <li><i class="far fa-user"></i>oliver</li>
  <li><i class="fas fa-code"></i>C</li>
</ul>

<p class="separator"></p>

<p>Introduction and Scanner…</p>

<blockquote>
  <p>Disclaimer: This is not the only or best way to do this. This is how I’ve done it. Maybe it helps with your project or maybe you get inspired to do something better.</p>
</blockquote>

<p>For my ecs system in my game I needed an easy way to add new components and systems, so I decided to write a small code generation tool to do that for me.
Here is what I have done.</p>

<p>First I needed to decide on a syntax for script file which decides what code to generate. After some changes I managed to plan out some syntax that fits my needs.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="n">define</span> <span class="n">ECS_LOADER_H</span>

<span class="n">include</span>
<span class="p">{</span>
    <span class="s">"Ecs/Ecs.h"</span><span class="p">,</span>
    <span class="s">"Components/Animator.h"</span><span class="p">,</span>
    <span class="s">"Components/Transform.h"</span><span class="p">,</span>
    <span class="s">"Components/RigidBody.h"</span><span class="p">,</span>
    <span class="s">"Components/Sprite.h"</span><span class="p">,</span>
    <span class="s">"Components/Movement.h"</span><span class="p">,</span>
    <span class="s">"Components/CameraController.h"</span><span class="p">,</span>
    <span class="s">"Components/Inventory.h"</span><span class="p">,</span>
    <span class="s">"Components/Interaction.h"</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">ComponentType</span>
<span class="p">{</span>
    <span class="p">[</span> <span class="n">COMPONENT_TRANSFORM</span><span class="p">,</span>      <span class="k">sizeof</span><span class="p">(</span><span class="n">Transform</span><span class="p">),</span>          <span class="nb">NULL</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_RIGID_BODY</span><span class="p">,</span>     <span class="k">sizeof</span><span class="p">(</span><span class="n">RigidBody</span><span class="p">),</span>          <span class="nb">NULL</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_MOVEMENT</span><span class="p">,</span>       <span class="k">sizeof</span><span class="p">(</span><span class="n">Movement</span><span class="p">),</span>           <span class="nb">NULL</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_SPRITE</span><span class="p">,</span>         <span class="k">sizeof</span><span class="p">(</span><span class="n">Sprite</span><span class="p">),</span>             <span class="nb">NULL</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_ANIMATOR</span><span class="p">,</span>       <span class="k">sizeof</span><span class="p">(</span><span class="n">Animator</span><span class="p">),</span>           <span class="n">AnimatorFree</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_CAMERA</span><span class="p">,</span>         <span class="k">sizeof</span><span class="p">(</span><span class="n">CameraController</span><span class="p">),</span>   <span class="nb">NULL</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_INVENTORY</span><span class="p">,</span>      <span class="k">sizeof</span><span class="p">(</span><span class="n">Inventory</span><span class="p">),</span>          <span class="n">InventoryFree</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_INTERACTION</span><span class="p">,</span>    <span class="k">sizeof</span><span class="p">(</span><span class="n">Interaction</span><span class="p">),</span>        <span class="nb">NULL</span> <span class="p">],</span>
    <span class="p">[</span> <span class="n">COMPONENT_INTERACTOR</span><span class="p">,</span>     <span class="k">sizeof</span><span class="p">(</span><span class="n">Interactor</span><span class="p">),</span>         <span class="nb">NULL</span> <span class="p">]</span>
<span class="p">}</span>

<span class="n">generate</span> <span class="n">RegisterComponents</span><span class="p">(</span><span class="n">Ecs</span><span class="o">*</span> <span class="n">ecs</span><span class="p">)</span><span class="o">:</span> <span class="n">ComponentType</span> <span class="o">-&gt;</span> <span class="n">EcsRegisterComponent</span><span class="p">(</span><span class="n">ecs</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The first line specifies the include guard for the generated c-file and is mandatory. After that comes the inluce block, that indicates what files does the generated file needs.
…</p>

<h2 id="the-scanner">The Scanner</h2>

<p>The following code was taken from Bob Nystrom’s book <a href="https://www.craftinginterpreters.com/">Crafting Interpreters</a>
The scanner takes in the script file and splits it into tokens. For my needs I needed these token types:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
    <span class="n">TokenType</span> <span class="n">type</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">start</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">len</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">line</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Token</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">start</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">current</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">line</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Scanner</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="k">typedef</span> <span class="k">enum</span>
<span class="p">{</span>
    <span class="n">TOKEN_COLON</span><span class="p">,</span>
    <span class="n">TOKEN_COMMA</span><span class="p">,</span>
    <span class="n">TOKEN_ASTERISK</span><span class="p">,</span>

    <span class="n">TOKEN_ARROW</span><span class="p">,</span>

    <span class="n">TOKEN_LEFT_PAREN</span><span class="p">,</span>
    <span class="n">TOKEN_RIGHT_PAREN</span><span class="p">,</span>
    <span class="n">TOKEN_LEFT_BRACE</span><span class="p">,</span>
    <span class="n">TOKEN_RIGHT_BRACE</span><span class="p">,</span>
    <span class="n">TOKEN_LEFT_BRACKET</span><span class="p">,</span>
    <span class="n">TOKEN_RIGHT_BRACKET</span><span class="p">,</span>
    
    <span class="cm">/* literals */</span>
    <span class="n">TOKEN_IDENTIFIER</span><span class="p">,</span>
    <span class="n">TOKEN_STRING</span><span class="p">,</span>

    <span class="cm">/* keywords */</span>
    <span class="n">TOKEN_ENUM</span><span class="p">,</span>
    <span class="n">TOKEN_DEFINE</span><span class="p">,</span>
    <span class="n">TOKEN_INCLUDE</span><span class="p">,</span>
    <span class="n">TOKEN_GENERATE</span><span class="p">,</span>

    <span class="n">TOKEN_ERROR</span><span class="p">,</span>
    <span class="n">TOKEN_EOF</span>
<span class="p">}</span> <span class="n">TokenType</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>These may vary if you have a different requirements and a different syntax.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
</pre></td><td class="code"><pre><span class="k">static</span> <span class="kt">int</span> <span class="nf">is_alpha</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">'a'</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'z'</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">'A'</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'Z'</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'_'</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">is_digit</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">'0'</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'9'</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">Token</span> <span class="nf">make_token</span><span class="p">(</span><span class="k">const</span> <span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">,</span> <span class="n">TokenType</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Token</span> <span class="n">token</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span> <span class="o">-</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">line</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">token</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">Token</span> <span class="nf">make_token_error</span><span class="p">(</span><span class="k">const</span> <span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Token</span> <span class="n">token</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">TOKEN_ERROR</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">message</span><span class="p">;</span>
    <span class="n">token</span><span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="n">token</span><span class="p">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">line</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">token</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">Token</span> <span class="nf">make_string</span><span class="p">(</span><span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'"'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\0'</span> <span class="o">||</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">make_token_error</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"Unterminated string."</span><span class="p">);</span>

        <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span> <span class="cm">/* closing quote */</span>
    <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_STRING</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">TokenType</span> <span class="nf">check_keyword</span><span class="p">(</span><span class="k">const</span> <span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">TokenType</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">keyword</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span> <span class="o">-</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">==</span> <span class="n">len</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">len</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">TOKEN_IDENTIFIER</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">TokenType</span> <span class="nf">get_identifier_type</span><span class="p">(</span><span class="k">const</span> <span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="sc">'d'</span><span class="p">:</span> <span class="k">return</span> <span class="n">check_keyword</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"define"</span><span class="p">,</span> <span class="n">TOKEN_DEFINE</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'e'</span><span class="p">:</span> <span class="k">return</span> <span class="n">check_keyword</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"enum"</span><span class="p">,</span> <span class="n">TOKEN_ENUM</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'g'</span><span class="p">:</span> <span class="k">return</span> <span class="n">check_keyword</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"generate"</span><span class="p">,</span> <span class="n">TOKEN_GENERATE</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'i'</span><span class="p">:</span> <span class="k">return</span> <span class="n">check_keyword</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"include"</span><span class="p">,</span> <span class="n">TOKEN_INCLUDE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">TOKEN_IDENTIFIER</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">Token</span> <span class="nf">make_identifier</span><span class="p">(</span><span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">is_alpha</span><span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">||</span> <span class="n">is_digit</span><span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> 
        <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">get_identifier_type</span><span class="p">(</span><span class="n">scanner</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">scanner_init</span><span class="p">(</span><span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">source</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">source</span><span class="p">;</span>
    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span> <span class="o">=</span> <span class="n">source</span><span class="p">;</span>

    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">line</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">scanner_match</span><span class="p">(</span><span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">scanner_skip_whitespaces</span><span class="p">(</span><span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="sc">' '</span><span class="p">:</span>
        <span class="k">case</span> <span class="sc">'\r'</span><span class="p">:</span>
        <span class="k">case</span> <span class="sc">'\t'</span><span class="p">:</span>
            <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="sc">'\n'</span><span class="p">:</span>
            <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">line</span><span class="o">++</span><span class="p">;</span>
            <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="cm">/* Comments */</span>
        <span class="k">case</span> <span class="sc">'#'</span><span class="p">:</span>
            <span class="k">while</span><span class="p">(</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span>
                <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>
        
        <span class="nl">default:</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Token</span> <span class="nf">scanner_get_next</span><span class="p">(</span><span class="n">Scanner</span><span class="o">*</span> <span class="n">scanner</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">scanner_skip_whitespaces</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>
    
    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_EOF</span><span class="p">);</span>

    <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">scanner</span><span class="o">-&gt;</span><span class="n">current</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">is_alpha</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">return</span> <span class="n">make_identifier</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="sc">':'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_COLON</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">','</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_COMMA</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'*'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_ASTERISK</span><span class="p">);</span>

    <span class="k">case</span> <span class="sc">'('</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_LEFT_PAREN</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">')'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_RIGHT_PAREN</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'{'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_LEFT_BRACE</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'}'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_RIGHT_BRACE</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">'['</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_LEFT_BRACKET</span><span class="p">);</span>
    <span class="k">case</span> <span class="sc">']'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_RIGHT_BRACKET</span><span class="p">);</span>

    <span class="k">case</span> <span class="sc">'-'</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scanner_match</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="sc">'&gt;'</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">make_token</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">TOKEN_ARROW</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">make_token_error</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"Expected '&gt;' after '-'."</span><span class="p">);</span>

    <span class="k">case</span> <span class="sc">'"'</span><span class="p">:</span> <span class="k">return</span> <span class="n">make_string</span><span class="p">(</span><span class="n">scanner</span><span class="p">);</span>
    
    <span class="nl">default:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">make_token_error</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="s">"Unexpected character."</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">token_cmp</span><span class="p">(</span><span class="n">Token</span><span class="o">*</span> <span class="n">token</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">strncmp</span><span class="p">(</span><span class="n">token</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">token</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">print_token</span><span class="p">(</span><span class="n">Token</span><span class="o">*</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%2d: %.*s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">token</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span> <span class="n">token</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">token</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>


<div class="comments">
  <i class="far fa-comments"></i>
  <p>
    Placeholder for a comment section.
  </p>
</div>
    </div>
    <footer class="page-footer container">
  <ul class="menu">
    
      <li><a href="/copyright.html"><i class="far fa-copyright"></i>2020 oliver jakobs</a></li>
    
      <li><a href="https://github.com/oliverjakobs"><i class="fab fa-github"></i>github</a></li>
    
      <li><a href="https://twitter.com/orwell_23"><i class="fab fa-twitter"></i>twitter</a></li>
    
  </ul>
</footer>
  </body>
</html>